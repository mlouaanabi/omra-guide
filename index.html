<!DOCTYPE html>
<html lang="fr">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
  <meta name="theme-color" content="#16a34a">
  <meta name="apple-mobile-web-app-capable" content="yes">
  <link rel="manifest" href="manifest.json">
  <title>Omra Guide</title>
  <script src="https://cdn.tailwindcss.com"></script>
  <script src="https://unpkg.com/react@18/umd/react.production.min.js"></script>
  <script src="https://unpkg.com/react-dom@18/umd/react-dom.production.min.js"></script>
  <script src="https://unpkg.com/@babel/standalone/babel.min.js"></script>
  <script src="https://cdnjs.cloudflare.com/ajax/libs/PapaParse/5.4.1/papaparse.min.js"></script>
  <script src="https://cdnjs.cloudflare.com/ajax/libs/xlsx/0.18.5/xlsx.full.min.js"></script>
  <script src="https://cdnjs.cloudflare.com/ajax/libs/jspdf/2.5.1/jspdf.umd.min.js"></script>
  <script src="https://cdnjs.cloudflare.com/ajax/libs/jspdf-autotable/3.5.31/jspdf.plugin.autotable.min.js"></script>
  <style>body{font-family:system-ui,sans-serif}@keyframes sos{0%,100%{transform:scale(1)}50%{transform:scale(1.1)}}.sos-btn{animation:sos 1s infinite}
.dark{background:#111827!important;color:#f3f4f6}
.dark .bg-white{background:#1f2937!important}
.dark .bg-gray-100{background:#111827!important}
.dark .bg-gray-200{background:#374151!important}
.dark .text-gray-500{color:#9ca3af!important}
.dark .text-gray-400{color:#9ca3af!important}
.dark .text-gray-600{color:#d1d5db!important}
.dark .border{border-color:#374151!important}
.dark .border-t{border-color:#374151!important}
.dark .shadow-sm{box-shadow:0 1px 2px rgba(0,0,0,0.3)!important}
.dark input,.dark select,.dark textarea{background:#374151!important;color:#f3f4f6!important;border-color:#4b5563!important}
.dark input::placeholder{color:#9ca3af!important}
</style>
</head>
<body>
<div id="root"></div>
<script type="text/babel">
const {useState,useEffect}=React;
const storage={get:k=>{try{return JSON.parse(localStorage.getItem(k))}catch{return null}},set:(k,v)=>{try{localStorage.setItem(k,JSON.stringify(v))}catch{}}};

function App(){
  const [pelerins,setPelerins]=useState([]);
  const [view,setView]=useState('dashboard');
  const [search,setSearch]=useState('');
  const [appel,setAppel]=useState({});
  const [editId,setEditId]=useState(null);
  const [hotels,setHotels]=useState({medine:[],makkah:[]});
  const [filters,setFilters]=useState({chambre:'',sexe:'',ageMin:'',ageMax:''});
  const [showFilters,setShowFilters]=useState(false);
  const [modal,setModal]=useState(null);
  const [urgence,setUrgence]=useState({consulat:'',agence:'',hotelMed:'',hotelMak:'',autre:''});
  const [darkMode,setDarkMode]=useState(false);
  const [tawafCount,setTawafCount]=useState(0);
  const [sayiCount,setSayiCount]=useState(0);
  const [spirituelTab,setSpirituelTab]=useState('guide');
  const [printModal,setPrintModal]=useState(false);

  useEffect(()=>{
    const p=storage.get('pelerins');if(p)setPelerins(p);
    const h=storage.get('hotels');if(h)setHotels(h);
    const u=storage.get('urgence');if(u)setUrgence(u);
    const d=storage.get('darkMode');if(d)setDarkMode(d);
  },[]);

  useEffect(()=>{
    if(darkMode){document.documentElement.classList.add('dark')}
    else{document.documentElement.classList.remove('dark')}
    storage.set('darkMode',darkMode);
  },[darkMode]);

  const save=d=>{setPelerins(d);storage.set('pelerins',d)};
  const saveH=d=>{setHotels(d);storage.set('hotels',d)};
  const saveU=d=>{setUrgence(d);storage.set('urgence',d)};
  const call=n=>n&&(window.location.href='tel:'+n.replace(/\s/g,''));
  const wa=n=>n&&window.open('https://wa.me/'+n.replace(/\s/g,'').replace(/^0/,'33'));
  const age=d=>{if(!d)return null;const t=new Date(),b=new Date(d);let a=t.getFullYear()-b.getFullYear();if(t.getMonth()<b.getMonth()||(t.getMonth()===b.getMonth()&&t.getDate()<b.getDate()))a--;return a};

  const handleFile=f=>{
    if(!f)return;
    if(f.name.endsWith('.csv'))Papa.parse(f,{header:true,skipEmptyLines:true,complete:r=>importData(r.data)});
    else{const rd=new FileReader();rd.onload=e=>{const wb=XLSX.read(new Uint8Array(e.target.result),{type:'array'});importData(XLSX.utils.sheet_to_json(wb.Sheets[wb.SheetNames[0]]))};rd.readAsArrayBuffer(f)}
  };

  const importData=data=>{
    const n=s=>s?s.toString().trim().toLowerCase().normalize("NFD").replace(/[\u0300-\u036f]/g,""):'';
    const imp=data.map(r=>{const o={};Object.keys(r).forEach(k=>o[n(k)]=r[k]);return{id:Date.now()+Math.random(),nom:o.nom||'',prenom:o.prenom||'',sexe:o.sexe?.toString().charAt(0).toUpperCase()==='F'?'F':o.sexe?.toString().charAt(0).toUpperCase()==='M'?'M':'',dateNaissance:o['date naissance']||o.naissance||'',nomFamille:o.famille||'',lienFamilial:o.lien||'',whatsapp:o.whatsapp||o.telephone||'',chambreMedine:o['chambre medine']||o.medine||'',chambreMakkah:o['chambre makkah']||o.makkah||'',hotelMedine:o['hotel medine']||'',hotelMakkah:o['hotel makkah']||'',commentaire:o.commentaire||''}}).filter(p=>p.nom&&p.prenom);
    if(!imp.length){alert('Aucune donnÃ©e');return}
    save([...pelerins,...imp]);setModal(null);alert('âœ… '+imp.length+' importÃ©(s)');
  };

  const exportXL=()=>{
    const d=pelerins.map(p=>({Nom:p.nom,Prenom:p.prenom,Sexe:p.sexe,Famille:p.nomFamille,'Chambre Medine':p.chambreMedine,'Chambre Makkah':p.chambreMakkah,WhatsApp:p.whatsapp,Commentaire:p.commentaire}));
    const wb=XLSX.utils.book_new();XLSX.utils.book_append_sheet(wb,XLSX.utils.json_to_sheet(d),"Pelerins");XLSX.writeFile(wb,'pelerins.xlsx');
  };

  // PDF Liste d'appel
  const printListeAppel=()=>{
    const {jsPDF}=window.jspdf;
    const doc=new jsPDF();
    doc.setFontSize(18);
    doc.text('Liste d\'appel - Omra',105,15,{align:'center'});
    doc.setFontSize(10);
    doc.text('Date: '+new Date().toLocaleDateString('fr-FR'),105,22,{align:'center'});
    
    const data=pelerins.map((p,i)=>[i+1,p.nom?.toUpperCase(),p.prenom,p.sexe==='F'?'F':'M',p.nomFamille||'-','â˜']);
    doc.autoTable({
      head:[['NÂ°','NOM','PrÃ©nom','S','Famille','âœ“']],
      body:data,
      startY:30,
      styles:{fontSize:9,cellPadding:3},
      headStyles:{fillColor:[22,163,74]},
      columnStyles:{0:{cellWidth:10},4:{cellWidth:30},5:{cellWidth:12,halign:'center'}}
    });
    doc.save('liste_appel_omra.pdf');
  };

  // PDF Rooming List
  const printRoomingList=(ville)=>{
    const {jsPDF}=window.jspdf;
    const doc=new jsPDF();
    doc.setFontSize(18);
    doc.text('Rooming List - '+(ville==='medine'?'MÃ©dine':'Makkah'),105,15,{align:'center'});
    doc.setFontSize(10);
    doc.text('Date: '+new Date().toLocaleDateString('fr-FR'),105,22,{align:'center'});
    
    const chambreField=ville==='medine'?'chambreMedine':'chambreMakkah';
    const hotelField=ville==='medine'?'hotelMedine':'hotelMakkah';
    
    const chambres={};
    pelerins.filter(p=>p[chambreField]).forEach(p=>{
      const num=p[chambreField];
      if(!chambres[num])chambres[num]={hotel:p[hotelField]||'-',occupants:[]};
      chambres[num].occupants.push(p);
    });
    
    const data=[];
    Object.keys(chambres).sort((a,b)=>parseInt(a)-parseInt(b)).forEach(num=>{
      const ch=chambres[num];
      ch.occupants.forEach((p,i)=>{
        data.push([i===0?num:'',i===0?ch.hotel:'',p.nom?.toUpperCase()+' '+p.prenom,p.sexe==='F'?'F':'M',p.whatsapp||'-']);
      });
    });
    
    doc.autoTable({
      head:[['Ch.','HÃ´tel','Nom PrÃ©nom','S','WhatsApp']],
      body:data,
      startY:30,
      styles:{fontSize:9,cellPadding:3},
      headStyles:{fillColor:[22,163,74]},
      columnStyles:{0:{cellWidth:15},1:{cellWidth:35},3:{cellWidth:10}}
    });
    doc.save('rooming_list_'+ville+'.pdf');
  };

  // PDF Fiche par chambre
  const printFicheChambres=(ville)=>{
    const {jsPDF}=window.jspdf;
    const doc=new jsPDF();
    
    const chambreField=ville==='medine'?'chambreMedine':'chambreMakkah';
    const hotelField=ville==='medine'?'hotelMedine':'hotelMakkah';
    
    const chambres={};
    pelerins.filter(p=>p[chambreField]).forEach(p=>{
      const num=p[chambreField];
      if(!chambres[num])chambres[num]={hotel:p[hotelField]||'-',occupants:[]};
      chambres[num].occupants.push(p);
    });
    
    let y=15;
    const nums=Object.keys(chambres).sort((a,b)=>parseInt(a)-parseInt(b));
    
    nums.forEach((num,idx)=>{
      if(y>250){doc.addPage();y=15;}
      const ch=chambres[num];
      
      doc.setFillColor(22,163,74);
      doc.rect(10,y,190,10,'F');
      doc.setTextColor(255,255,255);
      doc.setFontSize(12);
      doc.text('Chambre '+num+(ch.hotel?' - '+ch.hotel:''),15,y+7);
      doc.setTextColor(0,0,0);
      y+=15;
      
      ch.occupants.forEach(p=>{
        doc.setFontSize(10);
        doc.text('â€¢ '+p.nom?.toUpperCase()+' '+p.prenom+' ('+( p.sexe==='F'?'F':'M')+')',15,y);
        if(p.whatsapp){doc.setFontSize(8);doc.text('   ğŸ“± '+p.whatsapp,15,y+4);y+=4;}
        if(p.commentaire){doc.setFontSize(8);doc.setTextColor(200,100,0);doc.text('   âš ï¸ '+p.commentaire,15,y+4);doc.setTextColor(0,0,0);y+=4;}
        y+=8;
      });
      y+=5;
    });
    
    doc.save('fiches_chambres_'+ville+'.pdf');
  };

  // PDF Liste avec trombinoscope
  const printTrombinoscope=()=>{
    const {jsPDF}=window.jspdf;
    const doc=new jsPDF();
    doc.setFontSize(18);
    doc.text('Liste des pÃ¨lerins - Omra',105,15,{align:'center'});
    doc.setFontSize(10);
    doc.text(pelerins.length+' pÃ¨lerin(s) - '+new Date().toLocaleDateString('fr-FR'),105,22,{align:'center'});
    
    let y=35;
    let x=15;
    
    pelerins.forEach((p,i)=>{
      if(y>270){doc.addPage();y=15;x=15;}
      if(x>150){x=15;y+=45;}
      
      // Cadre
      doc.setDrawColor(200,200,200);
      doc.rect(x,y,55,40);
      
      // Avatar cercle
      doc.setFillColor(p.sexe==='F'?236:59,p.sexe==='F'?72:130,p.sexe==='F'?153:246);
      doc.circle(x+15,y+15,10,'F');
      doc.setTextColor(255,255,255);
      doc.setFontSize(12);
      doc.text((p.prenom?.[0]||'')+(p.nom?.[0]||''),x+15,y+18,{align:'center'});
      
      // Infos
      doc.setTextColor(0,0,0);
      doc.setFontSize(8);
      doc.text(p.prenom||'',x+30,y+10);
      doc.setFontSize(9);
      doc.text(p.nom?.toUpperCase()||'',x+30,y+16);
      doc.setFontSize(7);
      doc.setTextColor(100,100,100);
      if(p.chambreMedine)doc.text('Med: '+p.chambreMedine,x+30,y+22);
      if(p.chambreMakkah)doc.text('Mak: '+p.chambreMakkah,x+30,y+27);
      if(p.nomFamille)doc.text('Fam: '+p.nomFamille,x+30,y+32);
      
      x+=60;
    });
    
    doc.save('liste_pelerins_omra.pdf');
  };

  const filtered=pelerins.filter(p=>{
    if(search&&!p.nom?.toLowerCase().includes(search.toLowerCase())&&!p.prenom?.toLowerCase().includes(search.toLowerCase()))return false;
    if(filters.chambre&&!p.chambreMedine?.includes(filters.chambre)&&!p.chambreMakkah?.includes(filters.chambre))return false;
    if(filters.sexe&&p.sexe!==filters.sexe)return false;
    const a=age(p.dateNaissance);
    if(filters.ageMin&&(a===null||a<parseInt(filters.ageMin)))return false;
    if(filters.ageMax&&(a===null||a>parseInt(filters.ageMax)))return false;
    return true;
  });

  const familles=[...new Set(pelerins.map(p=>p.nomFamille).filter(Boolean))];
  const stats={total:pelerins.length,fam:familles.length,h:pelerins.filter(p=>p.sexe==='M').length,f:pelerins.filter(p=>p.sexe==='F').length};

  return(
    <div className="min-h-screen bg-gray-100 pb-20">
      <div className="bg-green-600 text-white px-4 py-3 sticky top-0 z-30 flex items-center justify-between">
        <div className="flex items-center gap-3">
          <span className="text-2xl">ğŸ•‹</span>
          <div><div className="font-bold">Omra Guide</div><div className="text-xs text-green-100">{pelerins.length} pÃ¨lerin(s)</div></div>
        </div>
        <button onClick={()=>setDarkMode(!darkMode)} className="text-2xl p-2">{darkMode?'â˜€ï¸':'ğŸŒ™'}</button>
      </div>

      <div className="p-4 space-y-4">
        {view==='dashboard'&&<>
          <div className="grid grid-cols-2 gap-3">
            <div className="bg-blue-500 text-white rounded-xl p-4"><div className="text-2xl font-bold">{stats.total}</div><div className="text-xs">PÃ¨lerins</div></div>
            <div className="bg-purple-500 text-white rounded-xl p-4"><div className="text-2xl font-bold">{stats.fam}</div><div className="text-xs">Familles</div></div>
            <div className="bg-sky-500 text-white rounded-xl p-4"><div className="text-2xl font-bold">{stats.h}</div><div className="text-xs">Hommes</div></div>
            <div className="bg-pink-500 text-white rounded-xl p-4"><div className="text-2xl font-bold">{stats.f}</div><div className="text-xs">Femmes</div></div>
          </div>
          <div className="bg-white rounded-xl p-4 shadow-sm">
            <div className="font-bold text-sm mb-3">âš¡ Actions</div>
            <div className="grid grid-cols-3 gap-2">
              <button onClick={()=>{setEditId(null);setView('form')}} className="flex flex-col items-center p-3 bg-green-50 rounded-lg"><span>â•</span><span className="text-xs">Ajouter</span></button>
              <button onClick={()=>setModal('import')} className="flex flex-col items-center p-3 bg-purple-50 rounded-lg"><span>ğŸ“¥</span><span className="text-xs">Import</span></button>
              <button onClick={exportXL} className="flex flex-col items-center p-3 bg-blue-50 rounded-lg"><span>ğŸ“¤</span><span className="text-xs">Export</span></button>
              <button onClick={()=>setPrintModal(true)} className="flex flex-col items-center p-3 bg-orange-50 rounded-lg"><span>ğŸ–¨ï¸</span><span className="text-xs">Imprimer</span></button>
            </div>
          </div>
        </>}

        {view==='list'&&<>
          <div className="flex gap-2">
            <input placeholder="ğŸ” Rechercher..." value={search} onChange={e=>setSearch(e.target.value)} className="flex-1 border rounded-xl px-3 py-2 text-sm"/>
            <button onClick={()=>setShowFilters(!showFilters)} className={`px-3 rounded-xl ${showFilters?'bg-green-600 text-white':'bg-gray-200'}`}>ğŸ”½</button>
            <button onClick={()=>{setEditId(null);setView('form')}} className="bg-green-600 text-white px-4 rounded-xl">+</button>
          </div>
          {showFilters&&<div className="bg-white rounded-xl p-3 shadow-sm">
            <div className="grid grid-cols-2 gap-2 mb-2">
              <input placeholder="Chambre" value={filters.chambre} onChange={e=>setFilters({...filters,chambre:e.target.value})} className="border rounded px-2 py-1 text-sm"/>
              <select value={filters.sexe} onChange={e=>setFilters({...filters,sexe:e.target.value})} className="border rounded px-2 py-1 text-sm"><option value="">Sexe</option><option value="M">Homme</option><option value="F">Femme</option></select>
              <input type="number" placeholder="Ã‚ge min" value={filters.ageMin} onChange={e=>setFilters({...filters,ageMin:e.target.value})} className="border rounded px-2 py-1 text-sm"/>
              <input type="number" placeholder="Ã‚ge max" value={filters.ageMax} onChange={e=>setFilters({...filters,ageMax:e.target.value})} className="border rounded px-2 py-1 text-sm"/>
            </div>
            <div className="flex justify-between text-xs"><span>{filtered.length}/{pelerins.length}</span><button onClick={()=>setFilters({chambre:'',sexe:'',ageMin:'',ageMax:''})} className="text-green-600">RÃ©init.</button></div>
          </div>}
          {filtered.map(p=><div key={p.id} className="bg-white rounded-xl p-3 shadow-sm flex justify-between items-center">
            <div className="flex items-center gap-3">
              <div className={`w-10 h-10 rounded-full flex items-center justify-center text-white font-bold ${p.sexe==='F'?'bg-pink-500':'bg-blue-500'}`}>{p.prenom?.[0]}{p.nom?.[0]}</div>
              <div>
                <div className="font-bold text-sm">{p.prenom} {p.nom} {age(p.dateNaissance)&&<span className="font-normal text-gray-500">({age(p.dateNaissance)})</span>}</div>
                <div className="text-xs text-gray-500">{p.chambreMedine&&`Med:${p.chambreMedine}`} {p.chambreMakkah&&`Mak:${p.chambreMakkah}`}</div>
                {p.commentaire&&<div className="text-xs text-orange-600">âš ï¸ {p.commentaire}</div>}
              </div>
            </div>
            <div className="flex">
              {p.whatsapp&&<button onClick={()=>wa(p.whatsapp)} className="p-2">ğŸ“±</button>}
              <button onClick={()=>{setEditId(p.id);setView('form')}} className="p-2">âœï¸</button>
              <button onClick={()=>{if(confirm('Supprimer?'))save(pelerins.filter(x=>x.id!==p.id))}} className="p-2">ğŸ—‘ï¸</button>
            </div>
          </div>)}
          {!filtered.length&&<div className="text-center py-10 text-gray-400">Aucun pÃ¨lerin</div>}
        </>}

        {view==='form'&&<Form p={editId?pelerins.find(x=>x.id===editId):null} hotels={hotels} onSave={d=>{save(editId?pelerins.map(x=>x.id===editId?{...d,id:editId}:x):[...pelerins,{...d,id:Date.now()}]);setView('list')}} onCancel={()=>setView('list')}/>}

        {view==='appel'&&<>
          <div className="bg-white rounded-xl p-3 shadow-sm flex justify-between"><span className="font-bold">âœ… Appel</span><span className="text-green-600 font-bold">{Object.values(appel).filter(Boolean).length}/{pelerins.length}</span></div>
          {pelerins.map(p=><div key={p.id} onClick={()=>setAppel({...appel,[p.id]:!appel[p.id]})} className={`bg-white rounded-xl p-3 shadow-sm flex justify-between ${appel[p.id]?'border-2 border-green-500':''}`}>
            <div className="flex items-center gap-3"><div className={`w-8 h-8 rounded-full flex items-center justify-center ${appel[p.id]?'bg-green-500 text-white':'bg-gray-200'}`}>{p.prenom?.[0]}{p.nom?.[0]}</div><span>{p.prenom} {p.nom}</span></div>
            {appel[p.id]?<span className="text-green-600">âœ“</span>:<span className="w-5 h-5 border-2 rounded-full"/>}
          </div>)}
          <button onClick={()=>setAppel({})} className="w-full bg-gray-500 text-white py-2 rounded-xl">RÃ©initialiser</button>
        </>}

        {view==='familles'&&<>
          <div className="font-bold">ğŸ‘¨â€ğŸ‘©â€ğŸ‘§ Familles ({familles.length})</div>
          {familles.map(f=>{const m=pelerins.filter(p=>p.nomFamille===f);return<div key={f} className="bg-white rounded-xl shadow-sm overflow-hidden mb-3"><div className="bg-purple-600 text-white px-4 py-2 font-bold">Famille {f} ({m.length})</div><div className="p-3">{m.map(x=><div key={x.id} className="flex items-center gap-2 py-1"><div className="w-6 h-6 bg-purple-500 rounded-full flex items-center justify-center text-white text-xs">{x.prenom?.[0]}</div><span className="text-sm">{x.prenom} {x.nom}</span>{x.lienFamilial&&<span className="text-xs text-gray-500">({x.lienFamilial})</span>}</div>)}</div></div>})}
        </>}

        {view==='spirituel'&&<>
          <div className="flex gap-2 mb-4">
            <button onClick={()=>setSpirituelTab('guide')} className={`flex-1 py-2 rounded-xl text-sm font-medium ${spirituelTab==='guide'?'bg-green-600 text-white':'bg-white'}`}>ğŸ“– Guide</button>
            <button onClick={()=>setSpirituelTab('duas')} className={`flex-1 py-2 rounded-xl text-sm font-medium ${spirituelTab==='duas'?'bg-green-600 text-white':'bg-white'}`}>ğŸ¤² Duas</button>
            <button onClick={()=>setSpirituelTab('compteur')} className={`flex-1 py-2 rounded-xl text-sm font-medium ${spirituelTab==='compteur'?'bg-green-600 text-white':'bg-white'}`}>ğŸ”¢ Compteur</button>
          </div>

          {spirituelTab==='guide'&&<div className="space-y-3">
            <div className="bg-white rounded-xl p-4 shadow-sm">
              <div className="text-lg font-bold mb-3">ğŸ•‹ Les Ã©tapes de la Omra</div>
              <div className="space-y-4">
                <div className="border-l-4 border-green-500 pl-3">
                  <div className="font-bold text-green-700">1. Ihram (Ø§Ù„Ø¥Ø­Ø±Ø§Ù…)</div>
                  <p className="text-sm text-gray-600">Entrer en Ã©tat de sacralisation au Miqat. Porter les vÃªtements blancs (hommes). Formuler l'intention et rÃ©citer la Talbiya.</p>
                </div>
                <div className="border-l-4 border-blue-500 pl-3">
                  <div className="font-bold text-blue-700">2. Tawaf (Ø§Ù„Ø·ÙˆØ§Ù)</div>
                  <p className="text-sm text-gray-600">Effectuer 7 tours autour de la Kaaba dans le sens inverse des aiguilles d'une montre. Commencer Ã  la pierre noire.</p>
                </div>
                <div className="border-l-4 border-purple-500 pl-3">
                  <div className="font-bold text-purple-700">3. PriÃ¨re 2 Rak'at</div>
                  <p className="text-sm text-gray-600">Prier 2 unitÃ©s derriÃ¨re le Maqam Ibrahim si possible, sinon n'importe oÃ¹ dans la mosquÃ©e.</p>
                </div>
                <div className="border-l-4 border-amber-500 pl-3">
                  <div className="font-bold text-amber-700">4. Sa'i (Ø§Ù„Ø³Ø¹ÙŠ)</div>
                  <p className="text-sm text-gray-600">Parcourir 7 fois entre Safa et Marwa. Commencer Ã  Safa, finir Ã  Marwa.</p>
                </div>
                <div className="border-l-4 border-pink-500 pl-3">
                  <div className="font-bold text-pink-700">5. Halq/Taqsir</div>
                  <p className="text-sm text-gray-600">Se raser la tÃªte (Halq) ou raccourcir les cheveux (Taqsir). Les femmes coupent une mÃ¨che.</p>
                </div>
              </div>
            </div>
            <div className="bg-amber-50 border border-amber-200 rounded-xl p-4">
              <div className="font-bold text-amber-800 mb-2">ğŸ“Œ Rappels importants</div>
              <ul className="text-sm text-amber-700 space-y-1">
                <li>â€¢ Rester en Ã©tat de puretÃ© (Wudu)</li>
                <li>â€¢ Ã‰viter les interdits de l'Ihram</li>
                <li>â€¢ Multiplier les invocations</li>
                <li>â€¢ Boire l'eau de Zamzam</li>
              </ul>
            </div>
          </div>}

          {spirituelTab==='duas'&&<div className="space-y-3">
            <div className="bg-white rounded-xl p-4 shadow-sm">
              <div className="font-bold text-green-700 mb-2">ğŸ“¿ Talbiya</div>
              <div className="bg-green-50 rounded-lg p-3 text-right text-lg mb-2" dir="rtl">Ù„ÙØ¨ÙÙ‘ÙŠÙ’ÙƒÙ Ø§Ù„Ù„ÙÙ‘Ù‡ÙÙ…ÙÙ‘ Ù„ÙØ¨ÙÙ‘ÙŠÙ’ÙƒÙØŒ Ù„ÙØ¨ÙÙ‘ÙŠÙ’ÙƒÙ Ù„ÙØ§ Ø´ÙØ±ÙÙŠÙƒÙ Ù„ÙÙƒÙ Ù„ÙØ¨ÙÙ‘ÙŠÙ’ÙƒÙØŒ Ø¥ÙÙ†ÙÙ‘ Ø§Ù„Ù’Ø­ÙÙ…Ù’Ø¯Ù ÙˆÙØ§Ù„Ù†ÙÙ‘Ø¹Ù’Ù…ÙØ©Ù Ù„ÙÙƒÙ ÙˆÙØ§Ù„Ù’Ù…ÙÙ„Ù’ÙƒÙØŒ Ù„ÙØ§ Ø´ÙØ±ÙÙŠÙƒÙ Ù„ÙÙƒÙ</div>
              <p className="text-sm text-gray-600">Labbayk Allahumma labbayk, labbayka la sharika laka labbayk. Innal-hamda wan-ni'mata laka wal-mulk, la sharika lak.</p>
            </div>
            <div className="bg-white rounded-xl p-4 shadow-sm">
              <div className="font-bold text-blue-700 mb-2">ğŸ•‹ En voyant la Kaaba</div>
              <div className="bg-blue-50 rounded-lg p-3 text-right text-lg mb-2" dir="rtl">Ø§Ù„Ù„ÙÙ‘Ù‡ÙÙ…ÙÙ‘ Ø²ÙØ¯Ù’ Ù‡ÙØ°ÙØ§ Ø§Ù„Ù’Ø¨ÙÙŠÙ’ØªÙ ØªÙØ´Ù’Ø±ÙÙŠÙÙ‹Ø§ ÙˆÙØªÙØ¹Ù’Ø¸ÙÙŠÙ…Ù‹Ø§ ÙˆÙØªÙÙƒÙ’Ø±ÙÙŠÙ…Ù‹Ø§ ÙˆÙÙ…ÙÙ‡ÙØ§Ø¨ÙØ©Ù‹</div>
              <p className="text-sm text-gray-600">Allahumma zid hadhal-bayta tashrifan wa ta'dhiman wa takriman wa mahabah.</p>
            </div>
            <div className="bg-white rounded-xl p-4 shadow-sm">
              <div className="font-bold text-purple-700 mb-2">âš« Ã€ la pierre noire</div>
              <div className="bg-purple-50 rounded-lg p-3 text-right text-lg mb-2" dir="rtl">Ø¨ÙØ³Ù’Ù…Ù Ø§Ù„Ù„ÙÙ‘Ù‡Ù ÙˆÙØ§Ù„Ù„ÙÙ‘Ù‡Ù Ø£ÙÙƒÙ’Ø¨ÙØ±Ù</div>
              <p className="text-sm text-gray-600">Bismillahi wallahu akbar</p>
            </div>
            <div className="bg-white rounded-xl p-4 shadow-sm">
              <div className="font-bold text-amber-700 mb-2">ğŸ”ï¸ Ã€ Safa et Marwa</div>
              <div className="bg-amber-50 rounded-lg p-3 text-right text-lg mb-2" dir="rtl">Ø¥ÙÙ†ÙÙ‘ Ø§Ù„ØµÙÙ‘ÙÙØ§ ÙˆÙØ§Ù„Ù’Ù…ÙØ±Ù’ÙˆÙØ©Ù Ù…ÙÙ†Ù’ Ø´ÙØ¹ÙØ§Ø¦ÙØ±Ù Ø§Ù„Ù„ÙÙ‘Ù‡Ù</div>
              <p className="text-sm text-gray-600">Innas-Safa wal-Marwata min sha'a'irillah</p>
            </div>
            <div className="bg-white rounded-xl p-4 shadow-sm">
              <div className="font-bold text-pink-700 mb-2">ğŸ¤² Invocation gÃ©nÃ©rale</div>
              <div className="bg-pink-50 rounded-lg p-3 text-right text-lg mb-2" dir="rtl">Ø±ÙØ¨ÙÙ‘Ù†ÙØ§ Ø¢ØªÙÙ†ÙØ§ ÙÙÙŠ Ø§Ù„Ø¯ÙÙ‘Ù†Ù’ÙŠÙØ§ Ø­ÙØ³ÙÙ†ÙØ©Ù‹ ÙˆÙÙÙÙŠ Ø§Ù„Ù’Ø¢Ø®ÙØ±ÙØ©Ù Ø­ÙØ³ÙÙ†ÙØ©Ù‹ ÙˆÙÙ‚ÙÙ†ÙØ§ Ø¹ÙØ°ÙØ§Ø¨Ù Ø§Ù„Ù†ÙÙ‘Ø§Ø±Ù</div>
              <p className="text-sm text-gray-600">Rabbana atina fid-dunya hasanatan wa fil-akhirati hasanatan wa qina 'adhaban-nar.</p>
            </div>
          </div>}

          {spirituelTab==='compteur'&&<div className="space-y-4">
            <div className="bg-white rounded-xl p-6 shadow-sm text-center">
              <div className="text-6xl mb-2">ğŸ•‹</div>
              <div className="font-bold text-xl mb-1">Tawaf</div>
              <div className="text-sm text-gray-500 mb-4">Tours autour de la Kaaba</div>
              <div className="text-6xl font-bold text-green-600 mb-4">{tawafCount}<span className="text-2xl text-gray-400">/7</span></div>
              <div className="flex gap-2 justify-center mb-4">
                {[1,2,3,4,5,6,7].map(n=><div key={n} className={`w-8 h-8 rounded-full flex items-center justify-center text-sm font-bold ${n<=tawafCount?'bg-green-500 text-white':'bg-gray-200'}`}>{n}</div>)}
              </div>
              <div className="flex gap-3 justify-center">
                <button onClick={()=>setTawafCount(Math.max(0,tawafCount-1))} className="bg-red-100 text-red-600 px-6 py-3 rounded-xl font-bold text-xl">âˆ’</button>
                <button onClick={()=>setTawafCount(Math.min(7,tawafCount+1))} className="bg-green-600 text-white px-6 py-3 rounded-xl font-bold text-xl">+</button>
              </div>
              <button onClick={()=>setTawafCount(0)} className="mt-3 text-sm text-gray-500">RÃ©initialiser</button>
              {tawafCount===7&&<div className="mt-4 bg-green-100 text-green-700 py-2 rounded-xl font-bold">âœ… Tawaf terminÃ© ! Alhamdulillah</div>}
            </div>

            <div className="bg-white rounded-xl p-6 shadow-sm text-center">
              <div className="text-6xl mb-2">ğŸƒ</div>
              <div className="font-bold text-xl mb-1">Sa'i</div>
              <div className="text-sm text-gray-500 mb-4">Parcours Safa â†” Marwa</div>
              <div className="text-6xl font-bold text-blue-600 mb-4">{sayiCount}<span className="text-2xl text-gray-400">/7</span></div>
              <div className="flex gap-2 justify-center mb-2">
                {[1,2,3,4,5,6,7].map(n=><div key={n} className={`w-8 h-8 rounded-full flex items-center justify-center text-sm font-bold ${n<=sayiCount?'bg-blue-500 text-white':'bg-gray-200'}`}>{n}</div>)}
              </div>
              <div className="text-xs text-gray-500 mb-4">{sayiCount===0?'DÃ©part: Safa':sayiCount%2===1?'â†’ Marwa':'â†’ Safa'}</div>
              <div className="flex gap-3 justify-center">
                <button onClick={()=>setSayiCount(Math.max(0,sayiCount-1))} className="bg-red-100 text-red-600 px-6 py-3 rounded-xl font-bold text-xl">âˆ’</button>
                <button onClick={()=>setSayiCount(Math.min(7,sayiCount+1))} className="bg-blue-600 text-white px-6 py-3 rounded-xl font-bold text-xl">+</button>
              </div>
              <button onClick={()=>setSayiCount(0)} className="mt-3 text-sm text-gray-500">RÃ©initialiser</button>
              {sayiCount===7&&<div className="mt-4 bg-blue-100 text-blue-700 py-2 rounded-xl font-bold">âœ… Sa'i terminÃ© ! Alhamdulillah</div>}
            </div>
          </div>}
        </>}
      </div>

      <div className="fixed bottom-0 left-0 right-0 bg-white border-t flex z-30">
        {[['ğŸ ','dashboard'],['ğŸ‘¥','list'],['âœ…','appel'],['ğŸ¤²','spirituel'],['ğŸ‘¨â€ğŸ‘©â€ğŸ‘§','familles']].map(([e,v])=><button key={v} onClick={()=>setView(v)} className={`flex-1 py-3 text-sm ${view===v?'text-green-600 border-t-2 border-green-600':'text-gray-500'}`}>{e}</button>)}
      </div>

      <button onClick={()=>setModal('sos')} className="sos-btn fixed bottom-20 right-4 w-14 h-14 bg-red-600 text-white rounded-full shadow-lg flex items-center justify-center text-2xl z-40">ğŸ†˜</button>

      {modal==='import'&&<div className="fixed inset-0 bg-black/50 flex items-center justify-center z-50 p-4" onClick={()=>setModal(null)}><div className="bg-white rounded-2xl p-5 w-full max-w-sm" onClick={e=>e.stopPropagation()}><div className="font-bold mb-4">ğŸ“¥ Importer</div><label className="block w-full bg-green-600 text-white py-3 rounded-xl text-center">SÃ©lectionner fichier<input type="file" accept=".csv,.xlsx" onChange={e=>e.target.files[0]&&handleFile(e.target.files[0])} className="hidden"/></label><button onClick={()=>setModal(null)} className="w-full mt-3 py-2 border rounded-xl">Fermer</button></div></div>}

      {modal==='sos'&&<div className="fixed inset-0 bg-black/70 flex items-center justify-center z-50 p-4" onClick={()=>setModal(null)}><div className="bg-white rounded-2xl w-full max-w-sm overflow-hidden" onClick={e=>e.stopPropagation()}>
        <div className="bg-red-600 text-white p-4 text-center"><span className="text-3xl">ğŸ†˜</span><div className="font-bold text-xl">URGENCES</div></div>
        <div className="p-4 space-y-2">
          <div className="font-bold text-sm text-gray-600">ğŸ‡¸ğŸ‡¦ NumÃ©ros officiels</div>
          <button onClick={()=>call('911')} className="w-full flex justify-between items-center bg-red-50 border border-red-200 rounded-xl p-3"><span>ğŸš¨ Urgences</span><span className="font-bold text-red-600">911</span></button>
          <button onClick={()=>call('997')} className="w-full flex justify-between items-center bg-orange-50 border border-orange-200 rounded-xl p-3"><span>ğŸš‘ Ambulance</span><span className="font-bold text-orange-600">997</span></button>
          <button onClick={()=>call('999')} className="w-full flex justify-between items-center bg-blue-50 border border-blue-200 rounded-xl p-3"><span>ğŸ‘® Police</span><span className="font-bold text-blue-600">999</span></button>
          
          <div className="font-bold text-sm text-gray-600 mt-4">ğŸ“± Mes contacts</div>
          {urgence.consulat&&<button onClick={()=>call(urgence.consulat)} className="w-full flex justify-between items-center bg-purple-50 border border-purple-200 rounded-xl p-3"><span>ğŸ›ï¸ Consulat</span><span className="text-sm">{urgence.consulat}</span></button>}
          {urgence.agence&&<button onClick={()=>call(urgence.agence)} className="w-full flex justify-between items-center bg-green-50 border border-green-200 rounded-xl p-3"><span>ğŸ¢ Agence</span><span className="text-sm">{urgence.agence}</span></button>}
          {urgence.hotelMed&&<button onClick={()=>call(urgence.hotelMed)} className="w-full flex justify-between items-center bg-blue-50 border border-blue-200 rounded-xl p-3"><span>ğŸ¨ HÃ´tel MÃ©dine</span><span className="text-sm">{urgence.hotelMed}</span></button>}
          {urgence.hotelMak&&<button onClick={()=>call(urgence.hotelMak)} className="w-full flex justify-between items-center bg-green-50 border border-green-200 rounded-xl p-3"><span>ğŸ¨ HÃ´tel Makkah</span><span className="text-sm">{urgence.hotelMak}</span></button>}
          {urgence.autre&&<button onClick={()=>call(urgence.autre)} className="w-full flex justify-between items-center bg-amber-50 border border-amber-200 rounded-xl p-3"><span>ğŸ‘¤ Autre</span><span className="text-sm">{urgence.autre}</span></button>}
          
          <button onClick={()=>setModal('urgence-config')} className="w-full bg-gray-100 py-2 rounded-xl text-sm mt-2">âš™ï¸ Configurer</button>
        </div>
        <button onClick={()=>setModal(null)} className="w-full bg-gray-200 py-3">Fermer</button>
      </div></div>}

      {modal==='urgence-config'&&<div className="fixed inset-0 bg-black/50 flex items-center justify-center z-50 p-4" onClick={()=>setModal('sos')}><div className="bg-white rounded-2xl p-5 w-full max-w-sm" onClick={e=>e.stopPropagation()}>
        <div className="font-bold mb-4">âš™ï¸ Configurer numÃ©ros</div>
        <div className="space-y-3">
          <div><label className="text-xs text-gray-500">ğŸ›ï¸ Consulat</label><input value={urgence.consulat} onChange={e=>setUrgence({...urgence,consulat:e.target.value})} className="w-full border rounded-xl px-3 py-2" placeholder="+966..."/></div>
          <div><label className="text-xs text-gray-500">ğŸ¢ Agence</label><input value={urgence.agence} onChange={e=>setUrgence({...urgence,agence:e.target.value})} className="w-full border rounded-xl px-3 py-2" placeholder="+966..."/></div>
          <div><label className="text-xs text-gray-500">ğŸ¨ HÃ´tel MÃ©dine</label><input value={urgence.hotelMed} onChange={e=>setUrgence({...urgence,hotelMed:e.target.value})} className="w-full border rounded-xl px-3 py-2" placeholder="+966..."/></div>
          <div><label className="text-xs text-gray-500">ğŸ¨ HÃ´tel Makkah</label><input value={urgence.hotelMak} onChange={e=>setUrgence({...urgence,hotelMak:e.target.value})} className="w-full border rounded-xl px-3 py-2" placeholder="+966..."/></div>
          <div><label className="text-xs text-gray-500">ğŸ‘¤ Autre</label><input value={urgence.autre} onChange={e=>setUrgence({...urgence,autre:e.target.value})} className="w-full border rounded-xl px-3 py-2" placeholder="+33..."/></div>
        </div>
        <button onClick={()=>{saveU(urgence);setModal('sos')}} className="w-full bg-green-600 text-white py-2 rounded-xl mt-4">ğŸ’¾ Enregistrer</button>
      </div></div>}

      {printModal&&<div className="fixed inset-0 bg-black/50 flex items-center justify-center z-50 p-4" onClick={()=>setPrintModal(false)}><div className="bg-white rounded-2xl p-5 w-full max-w-sm" onClick={e=>e.stopPropagation()}>
        <div className="font-bold text-lg mb-4">ğŸ–¨ï¸ Impressions PDF</div>
        <div className="space-y-2">
          <button onClick={()=>{printListeAppel();setPrintModal(false)}} className="w-full flex items-center gap-3 bg-green-50 border border-green-200 rounded-xl p-3 text-left hover:bg-green-100">
            <span className="text-2xl">ğŸ“‹</span>
            <div><div className="font-medium">Liste d'appel</div><div className="text-xs text-gray-500">Pour pointer les pÃ¨lerins</div></div>
          </button>
          <button onClick={()=>{printTrombinoscope();setPrintModal(false)}} className="w-full flex items-center gap-3 bg-blue-50 border border-blue-200 rounded-xl p-3 text-left hover:bg-blue-100">
            <span className="text-2xl">ğŸ‘¥</span>
            <div><div className="font-medium">Liste avec photos</div><div className="text-xs text-gray-500">Trombinoscope des pÃ¨lerins</div></div>
          </button>
          <div className="pt-2 border-t">
            <div className="text-sm font-medium text-gray-600 mb-2">ğŸ¨ Rooming List</div>
            <div className="flex gap-2">
              <button onClick={()=>{printRoomingList('medine');setPrintModal(false)}} className="flex-1 bg-blue-500 text-white py-2 rounded-xl text-sm">MÃ©dine</button>
              <button onClick={()=>{printRoomingList('makkah');setPrintModal(false)}} className="flex-1 bg-green-500 text-white py-2 rounded-xl text-sm">Makkah</button>
            </div>
          </div>
          <div className="pt-2 border-t">
            <div className="text-sm font-medium text-gray-600 mb-2">ğŸšª Fiches par chambre</div>
            <div className="flex gap-2">
              <button onClick={()=>{printFicheChambres('medine');setPrintModal(false)}} className="flex-1 bg-blue-500 text-white py-2 rounded-xl text-sm">MÃ©dine</button>
              <button onClick={()=>{printFicheChambres('makkah');setPrintModal(false)}} className="flex-1 bg-green-500 text-white py-2 rounded-xl text-sm">Makkah</button>
            </div>
          </div>
        </div>
        <button onClick={()=>setPrintModal(false)} className="w-full mt-4 py-2 border rounded-xl">Fermer</button>
      </div></div>}
    </div>
  );
}

function Form({p,hotels,onSave,onCancel}){
  const [f,setF]=useState({nom:p?.nom||'',prenom:p?.prenom||'',sexe:p?.sexe||'',dateNaissance:p?.dateNaissance||'',nomFamille:p?.nomFamille||'',lienFamilial:p?.lienFamilial||'',whatsapp:p?.whatsapp||'',chambreMedine:p?.chambreMedine||'',chambreMakkah:p?.chambreMakkah||'',hotelMedine:p?.hotelMedine||'',hotelMakkah:p?.hotelMakkah||'',commentaire:p?.commentaire||''});
  return(
    <div className="bg-white rounded-xl p-4 shadow-sm">
      <div className="font-bold mb-4">{p?'âœï¸ Modifier':'â• Ajouter'}</div>
      <div className="space-y-3">
        <div className="grid grid-cols-2 gap-2"><input placeholder="Nom*" value={f.nom} onChange={e=>setF({...f,nom:e.target.value})} className="border rounded-xl px-3 py-2"/><input placeholder="PrÃ©nom*" value={f.prenom} onChange={e=>setF({...f,prenom:e.target.value})} className="border rounded-xl px-3 py-2"/></div>
        <div className="grid grid-cols-2 gap-2"><select value={f.sexe} onChange={e=>setF({...f,sexe:e.target.value})} className="border rounded-xl px-3 py-2"><option value="">Sexe</option><option value="M">Homme</option><option value="F">Femme</option></select><input type="date" value={f.dateNaissance} onChange={e=>setF({...f,dateNaissance:e.target.value})} className="border rounded-xl px-3 py-2"/></div>
        <div className="grid grid-cols-2 gap-2"><input placeholder="Famille" value={f.nomFamille} onChange={e=>setF({...f,nomFamille:e.target.value})} className="border rounded-xl px-3 py-2"/><select value={f.lienFamilial} onChange={e=>setF({...f,lienFamilial:e.target.value})} className="border rounded-xl px-3 py-2"><option value="">Lien</option><option>Ã‰poux</option><option>Ã‰pouse</option><option>PÃ¨re</option><option>MÃ¨re</option><option>Fils</option><option>Fille</option></select></div>
        <input placeholder="WhatsApp" value={f.whatsapp} onChange={e=>setF({...f,whatsapp:e.target.value})} className="w-full border rounded-xl px-3 py-2"/>
        <div className="grid grid-cols-2 gap-2"><input placeholder="Chambre MÃ©dine" value={f.chambreMedine} onChange={e=>setF({...f,chambreMedine:e.target.value})} className="border rounded-xl px-3 py-2"/><input placeholder="Chambre Makkah" value={f.chambreMakkah} onChange={e=>setF({...f,chambreMakkah:e.target.value})} className="border rounded-xl px-3 py-2"/></div>
        <textarea placeholder="Commentaire santÃ©" value={f.commentaire} onChange={e=>setF({...f,commentaire:e.target.value})} className="w-full border rounded-xl px-3 py-2" rows={2}/>
      </div>
      <div className="flex gap-3 mt-4"><button onClick={onCancel} className="flex-1 border py-2 rounded-xl">Annuler</button><button onClick={()=>{if(!f.nom||!f.prenom){alert('Nom et prÃ©nom requis');return}onSave(f)}} className="flex-1 bg-green-600 text-white py-2 rounded-xl">ğŸ’¾ Sauver</button></div>
    </div>
  );
}

ReactDOM.createRoot(document.getElementById('root')).render(<App/>);
</script>
</body>
</html>
